---
tags:
상태: Ref
중요:
생성일: 26-01-28T10:48:18
수정일: 26-01-30T14:42:15
종료일:
라벨:
  - Ref
---
## 0. 참고 레퍼런스
- [[(Learn) 법선 벡터 기반 방식]]
- [[(Learn) Outline Shader, Stencil Buffer 방식]]
- [[(Ref) 정점 법선 벡터 분석을 통한 가상 피벗 방식 + Metadata Mapping 방식]]
##  ■■ Description ■■
- 
## 1. Bounding Box & Offset + Metadata Mapping 방식 검토
### 1-1 방식 개요
- **Bounding Box & Offset 기반 방식**과 **Metadata Mapping(메타데이터 매핑)** 을 결합하여 구현하는 방식이다.
- 이 방식은 3D 모델 내에 별도의 **'더미 노드(Socket/Pivot)'가 존재하지 않을 때**, 
  객체의 기하학적 정보(Bounding Box)와 외부 설정 데이터(Metadata)를 결합하여 
  정밀한 조립 위치를 계산하는 방식이다.
### 2.2 방식의 장점
| 장점             | 설명                               |
| -------------- | -------------------------------- |
| **모델링 의존성 제거** | GLB 파일 수정 없이 코드 레벨에서 조립 로직 구현 가능 |
| **유연한 오프셋 조정** | JSON 설정 파일을 통해 미세 조정값을 동적으로 관리   |
| **유지보수 용이성**   | 오프셋 값이 코드에 하드코딩되지 않아 수정이 쉬움      |
| **확장성**        | 새로운 부품 추가 시 설정 파일만 업데이트하면 됨      |
| **버전 관리 용이**   | 설정 파일을 별도로 관리하여 변경 이력 추적 가능      |
### 2-2. Metadata Mapping 방식 장단점
**장점:**
- ✅ **정확성**: 수동으로 설정한 오프셋으로 정확한 조립 보장
- ✅ **성능**: 계산 없이 즉시 적용 가능
- ✅ **디버깅 용이**: 명시적인 값으로 문제 해결 쉬움
**단점:**
- ❌ **수동 작업**: 각 부품별로 오프셋 값을 수동으로 입력해야 함
- ❌ **유지보수**: 모델 변경 시 메타데이터 업데이트 필요
- ❌ **확장성**: 새로운 부품 추가 시 메타데이터 작업 필요
### 2.4 결론
**Bounding Box & Offset + Metadata Mapping 방식은 현재 상황에서 가장 적합한 솔루션**
- 더미 노드가 없는 상황에서 엔터프라이즈급 솔루션으로 충분히 기능함
- 모델링 파일 수정 없이 구현 가능하므로 개발 기간 단축
- Metadata Mapping을 통해 정밀도 요구사항 충족 가능
## 3. 주요 작업 흐름 (Workflow)
1) 대상 노드 확보 (Node Acquisition)
2) 메타데이터 로드 (Metadata Loading)
3) 홈 중심점 계산 (Groove Center Calculation)
	   - 타겟 노드의 `Bounding Box`를 구하고, 설정된 `innerBoundRatio`를 적용하여 홈의 기하학적 중심점(`grooveCenter`)을 World Space 좌표로 산출
4) 타겟 월드 좌표 계산 (Target World Position)
	   - 메타데이터의 `insertionOffset`에 타겟의 회전값을 적용(`applyQuaternion`)하여, 타겟이 기울어져 있더라도 올바른 방향으로 오프셋이 적용되도록 한다.
5) 로컬 좌표 변환 (Coordinate Transformation)
	   - `worldToLocal` 메서드를 사용하기 전, 부모의 `updateMatrixWorld(true)`를 호출하여 최신 행렬 정보를 반영함으로써 변환 오차를 방지
6)  애니메이션 실행 (Animation)
	   - `GSAP` 라이브러리를 사용하여 부품의 `position`을 계산된 로컬 좌표로 부드럽게 이동시킨다.
	   - 현재 구현에서는 X, Y 축 위주로 이동하며, `power2.inOut` 이징을 적용하여 자연스러운 움직임을 연출한다.
## 3. 동작 방식의 특징
| 특징           | 설명                                                                      |
| :----------- | :---------------------------------------------------------------------- |
| **비침습적 방식**  | 3D 모델링 데이터를 직접 수정(더미 노드 추가 등)하지 않고도 조립 로직 구현 가능                         |
| **유연한 유지보수** | 조립 위치가 미세하게 어긋날 경우, 코드 수정 없이 `assembly-offsets.json`의 오프셋 값만 변경하여 대응 가능 |
| **회전 대응**    | 타겟 노드의 World Quaternion을 계산에 포함하여, 냉장고 본체가 어떤 각도로 배치되어 있어도 정확한 조립 방향 유지 |
| **정밀도 제어**   | `innerBoundRatio`를 통해 복잡한 메쉬 구조 내에서도 특정 영역을 조립 기준으로 설정 가능               |
